<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Experiments," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="V2V fine-tuning on Galtech and Cityscape, 16 frames, idea from V2V.">
<meta property="og:type" content="article">
<meta property="og:title" content="V2V-Cityscape, V2V-Galtech">
<meta property="og:url" content="http://yoursite.com/2016/07/17/2016-07-17-experiments-v2v/index.html">
<meta property="og:site_name" content="holyseven's blog">
<meta property="og:description" content="V2V fine-tuning on Galtech and Cityscape, 16 frames, idea from V2V.">
<meta property="og:image" content="http://yoursite.com/images/v2v0.png">
<meta property="og:image" content="http://yoursite.com/images/v2v_smallerlr.png">
<meta property="og:updated_time" content="2016-07-20T14:26:57.488Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="V2V-Cityscape, V2V-Galtech">
<meta name="twitter:description" content="V2V fine-tuning on Galtech and Cityscape, 16 frames, idea from V2V.">
<meta name="twitter:image" content="http://yoursite.com/images/v2v0.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> V2V-Cityscape, V2V-Galtech | holyseven's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">holyseven's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                V2V-Cityscape, V2V-Galtech
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-07-17T10:00:00+02:00" content="2016-07-17">
              2016-07-17
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/17/2016-07-17-experiments-v2v/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/17/2016-07-17-experiments-v2v/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>V2V fine-tuning on Galtech and Cityscape, 16 frames, idea from <a href="http://arxiv.org/pdf/1511.06681v1.pdf" target="_blank" rel="external">V2V</a>.<br><a id="more"></a></p>
<h2 id="V2V-on-Cityscape"><a href="#V2V-on-Cityscape" class="headerlink" title="V2V on Cityscape"></a>V2V on Cityscape</h2><p>V2V is designed for voxel prediction, not only classifying pixels in one image, but in all 16 frames.</p>
<p>While FCN-8S could have nearly 90% classification accuracy, we firstly segment all images of the sequences of Cityscape, where only the 20th image is manually completely annotated and the rest has no ground truth. We consider the FCN-8S results as fake ground truth.</p>
<p>We use this fake ground truth plus the 20th image true ground truth to train the V2V model.</p>
<p>Since the structure of V2V has several layers in common as C3D, it could copy the weights from C3D. C3D is trained on Sport-1M for action recognition.</p>
<blockquote>
<p><strong>Training on Cityscape starts on 15, July</strong><br>Finished on 17 July. Each pixel has an average 0.9 loss, while for FCN-8S, each pixel 0.2~0.3.</p>
<p><strong>Test directly on training database, starts on 17 July</strong><br>Val database has not been constructed yet so I test on training data at first. I test 6k_iter, 12_iter, 24, 36 and 54.<br>54k: 65.9629%<br>36k: 65.3071%<br>24k: 64.7252%<br>12k: 63.9687%<br>6k:  61.9525%<br>I think if I continue to train it, the precision will increase but will not surpasse 70%, which means it can not reach the niveau of FCN.</p>
</blockquote>
<p>The rest Cityscape training detail:</p>
<p>solver.prototxt<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">base_lr:</span> <span class="number">1e-9</span> </span><br><span class="line"><span class="meta"># high momentum</span></span><br><span class="line"><span class="symbol">stepvalue:</span> <span class="number">200</span> <span class="meta"># 1</span></span><br><span class="line"><span class="symbol">stepvalue:</span> <span class="number">2975</span> <span class="meta"># 2</span></span><br><span class="line"><span class="symbol">stepvalue:</span> <span class="number">6000</span> <span class="meta"># 4</span></span><br><span class="line"><span class="symbol">stepvalue:</span> <span class="number">47600</span> <span class="meta"># 16</span></span><br><span class="line"><span class="symbol">stepvalue:</span> <span class="number">100000</span></span><br><span class="line"><span class="symbol">gamma:</span> <span class="number">0.2</span></span><br><span class="line"><span class="symbol">momentum:</span> <span class="number">0.95</span></span><br><span class="line"><span class="meta"># no gradient accumulation</span></span><br><span class="line"><span class="symbol">iter_size:</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">weight_decay:</span> <span class="number">0.0005</span></span><br></pre></td></tr></table></figure></p>
<h2 id="V2V-on-Galtech"><a href="#V2V-on-Galtech" class="headerlink" title="V2V on Galtech"></a>V2V on Galtech</h2><p>Because of this not-good-enough result on Cityscape, I have to check whether my codes have bugs or not. So I train the same net on Galtech, which is the database in the article V2V. Galtech has 63 videos for training, 38 for validation. Each video has 60 to 400 frames, each frame is annotated for 8 classes.</p>
<p>All frames are resized to 128x171, and cropped to 112x112 and then put 16 frames to the net for training. Output is also 16 frames of 112x112. Each pixel will contribute for the loss function.</p>
<p>Unluckily, the results on validation set are not very good:</p>
<blockquote>
<p>24k: 51.2222<br>60k: 52.2793<br>90k: 51.7703<br>120k: 52.6046</p>
</blockquote>
<p>Strangely, the results on training set are good:</p>
<blockquote>
<p>120k: 73.8189<br>198k: 73.1337</p>
</blockquote>
<p>(All snapshot are saved in ./snapshot0)</p>
<p>Loss<br><img src="/images/v2v0.png" alt="Loss evoluation" title="Loss"></p>
<h2 id="V2V-on-Galtech-with-smaller-learning-rate"><a href="#V2V-on-Galtech-with-smaller-learning-rate" class="headerlink" title="V2V on Galtech with smaller learning rate"></a>V2V on Galtech with smaller learning rate</h2><p><del>It seems like overfitting (results on training set ourperform much the results on val set).</del> </p>
<blockquote>
<p>Maybe more important reason is lack of bias parameters in deconvolution layers.</p>
</blockquote>
<p>So I decide to decrease the learning rate and retrain it. Suggested from the article, normalize the loss, learning rate is set to 1e-4 and is divided by 10 every 30k iteration. For the two previous trainings, I set the bias parameters to false for all deconvolution layers, and this time, I add those bias parameters.</p>
<p>Results on validation set:</p>
<blockquote>
<p>12k: 72.9577<br>60k: 74.0443</p>
</blockquote>
<p>Loss<br><img src="/images/v2v_smallerlr.png" alt="Loss evoluation" title="Loss"></p>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Experiments/" rel="tag">#Experiments</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/06/30/2016-06-28-caffe-code-weights-updating/" rel="next" title="Caffe Code Reading - Weights updating">
                <i class="fa fa-chevron-left"></i> Caffe Code Reading - Weights updating
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/07/17/2016-07-17-experiments-gvfin/" rel="prev" title="Generate images from ImageNet for C3D finetuning">
                Generate images from ImageNet for C3D finetuning <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/07/17/2016-07-17-experiments-v2v/"
           data-title="V2V-Cityscape, V2V-Galtech" data-url="http://yoursite.com/2016/07/17/2016-07-17-experiments-v2v/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="holyseven" />
          <p class="site-author-name" itemprop="name">holyseven</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">16</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#V2V-on-Cityscape"><span class="nav-number">1.</span> <span class="nav-text">V2V on Cityscape</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#V2V-on-Galtech"><span class="nav-number">2.</span> <span class="nav-text">V2V on Galtech</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#V2V-on-Galtech-with-smaller-learning-rate"><span class="nav-number">3.</span> <span class="nav-text">V2V on Galtech with smaller learning rate</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">holyseven</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"holyseven"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  






  
  
  

  

  

</body>
</html>
