<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Experiments," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="C3D on Cityscape, 16 frames…">
<meta property="og:type" content="article">
<meta property="og:title" content="Experiments of Cropped-Image-C3D-Cityscape">
<meta property="og:url" content="http://yoursite.com/2016/06/28/2016-06-28-experiments-crop-c3d-cityscape/index.html">
<meta property="og:site_name" content="holyseven's blog">
<meta property="og:description" content="C3D on Cityscape, 16 frames…">
<meta property="og:updated_time" content="2016-07-11T14:22:36.535Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Experiments of Cropped-Image-C3D-Cityscape">
<meta name="twitter:description" content="C3D on Cityscape, 16 frames…">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> Experiments of Cropped-Image-C3D-Cityscape | holyseven's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">holyseven's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Experiments of Cropped-Image-C3D-Cityscape
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-06-28T10:00:00+02:00" content="2016-06-28">
              2016-06-28
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/28/2016-06-28-experiments-crop-c3d-cityscape/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/28/2016-06-28-experiments-crop-c3d-cityscape/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>C3D on Cityscape, 16 frames…</p>
<a id="more"></a>
<ul>
<li><strong>Dataset</strong>: Cityscape</li>
<li><strong>Input</strong>: 16 consecutive frames<ul>
<li>The input blob size is 1x1x48xHxW, not 1x3x16xHxW. And the first convolutional layer’s kernel size is changed, too (9x3x3), which is equivalent to original C3D. </li>
<li>However, 1x1x48x1024x2048 will comsume nearly 40G GPU memory, which is impossible at this moment. So I, firstly reduced the resolution, resized images into 450x900. This reduction of resolution will decrease the precision. So another solution is to crop the image. I’ve written a Python input layer for getting the same bounding box for images and ground truth at one time. At first, I chosed 450x900, but I ended it and I chosed 600x600 for weighted softmax loss function.</li>
</ul>
</li>
<li><strong>Loss</strong>: Weighted softmax loss function<ul>
<li>According to my computation, for one pixel in the output layer before deconvolution, its receptive field is 187x187, depending on the network structure only. So for a smaller bounding box in the output 600x600, I set the weight 1 to the center region and 0.1 to the border region. </li>
<li>When I use cropped images, the pixels near the border can not have a valid receptive field. So I assign those invalid pixels lower weights (0.1). For those which have valid receptive field, I don’t change the loss. This is implemented in caffe. I have added a new layer. It seems easy but … In bref, it’s done.</li>
</ul>
</li>
<li><strong>ConvNet</strong>: C3D <ul>
<li>Like FCN, I have turned the last three fully connected layers into convolutional layers. The kernel size of 6th convolutional group is 1x4x4, which is computed from the original C3D structure.</li>
</ul>
</li>
</ul>
<p><del>This kind of configuration have not started training. The training at this time, is without the weighted layer, it considers all pixels the same. I don’t know which is better but the weighted layer is logic. I will start the training tomorrow.</del><br>Changed to</p>
<blockquote>
<p><strong>Training starts at 10h, 29 juin</strong><br>Two trainings. one is reducted resolution(450x900); another is weighted loss with cropped images(600x600).<br><strong>Training ends on 8 july</strong><br>The result of approach of reducted resolution is 72% while weighted loss is 70%, noting that FCN trained on Cityscape’s single image (not 16 consecutive frames) is 85%.<br><strong>Training with smaller learning rate for the weighted loss approach starts 10 july</strong><br>fixed learning rate: 3e-13</p>
</blockquote>
<p>The rest training detail:</p>
<p>solver.prototxt<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">train_net:</span> <span class="string">"fcn_c3d_train.prototxt"</span></span><br><span class="line"><span class="symbol">display:</span> <span class="number">5</span></span><br><span class="line"><span class="symbol">average_loss:</span> <span class="number">20</span></span><br><span class="line"><span class="symbol">lr_policy:</span> <span class="string">"multistep"</span></span><br><span class="line"><span class="meta"># lr for unnormalized softmax</span></span><br><span class="line"><span class="symbol">base_lr:</span> <span class="number">3e-11</span> <span class="meta"># 5e-12 for reducted resolution</span></span><br><span class="line"><span class="meta"># high momentum</span></span><br><span class="line"><span class="symbol">stepvalue:</span> <span class="number">2975</span> <span class="meta"># 1</span></span><br><span class="line"><span class="symbol">stepvalue:</span> <span class="number">5950</span> <span class="meta"># 2</span></span><br><span class="line"><span class="symbol">stepvalue:</span> <span class="number">11900</span> <span class="meta"># 4</span></span><br><span class="line"><span class="symbol">stepvalue:</span> <span class="number">47600</span> <span class="meta"># 16</span></span><br><span class="line"><span class="symbol">stepvalue:</span> <span class="number">100000</span></span><br><span class="line"><span class="symbol">gamma:</span> <span class="number">0.2</span></span><br><span class="line"><span class="symbol">momentum:</span> <span class="number">0.99</span></span><br><span class="line"><span class="meta"># no gradient accumulation</span></span><br><span class="line"><span class="symbol">iter_size:</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">max_iter:</span> <span class="number">300000</span></span><br><span class="line"><span class="symbol">weight_decay:</span> <span class="number">0.0005</span></span><br><span class="line"><span class="symbol">snapshot:</span> <span class="number">3000</span></span><br><span class="line"><span class="symbol">snapshot_prefix:</span> <span class="string">"snapshot/train"</span></span><br></pre></td></tr></table></figure></p>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Experiments/" rel="tag">#Experiments</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/06/14/2016-06-14-shell-notes/" rel="next" title="linux shell notes">
                <i class="fa fa-chevron-left"></i> linux shell notes
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/06/28/2016-06-28-caffe-code-reading-softmax-with-loss/" rel="prev" title="Caffe Code Reading - softmax with loss">
                Caffe Code Reading - softmax with loss <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/06/28/2016-06-28-experiments-crop-c3d-cityscape/"
           data-title="Experiments of Cropped-Image-C3D-Cityscape" data-url="http://yoursite.com/2016/06/28/2016-06-28-experiments-crop-c3d-cityscape/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="holyseven" />
          <p class="site-author-name" itemprop="name">holyseven</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">14</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <p class="post-toc-empty">This post does not have a Table of Contents</p>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">holyseven</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"holyseven"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  






  
  
  

  

  

</body>
</html>
